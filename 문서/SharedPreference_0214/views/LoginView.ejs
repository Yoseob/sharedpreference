<!DOCTYPE html>
<html lang="en" xmlns:fb="http://www.facebook.com/2008/fbml">
<head>


    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Landing Sumo is a site with a collection of landing pages created using the awesome Bootstrap 3 framework.">
    <meta name="author" content="Carlos Alvarez">

    <title><%= title %></title>

    <!-- Bootstrap core CSS -->
    <link href="/stylesheets/bootstrap.css" rel="stylesheet">
    <link href="/stylesheets/superslides.css" rel="stylesheet">
    <link href="/stylesheets/ionicons.css" rel="stylesheet">
    <link href="/stylesheets/styleLogin.css" rel="stylesheet">

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="/javascripts/ie10-viewport-bug-workaround.js"></script>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <!--<script src="../../assets/js/html5shiv.js"></script>
    <script src="../../assets/js/respond.min.js"></script>-->
    <script src="/javascripts/webrtc.io.js"></script>

    <!--[endif]-->

</head>

<body data-spy="scroll" data-offset="0" data-target="#theMenu">
<script>


    var secret = '3629858ea14fe0e8eb61e368a9839559';
    var IsUsername = '';
    var USER_NAME = 'username';
    var access_token='';

    /*
     // This is called with the results from from FB.getLoginStatus().
     function statusChangeCallback(response) {
     console.log('statusChangeCallback');
     console.log(response);
     // The response object is returned with a status field that lets the
     // app know the current login status of the person.
     // Full docs on the response object can be found in the documentation
     // for FB.getLoginStatus().
     if (response.status === 'connected') {
     // Logged into your app and Facebook.
     console.log(response);
     var accessToeken = response.authResponse.accessToken;
     requetMyFacebookInfo(accessToeken);
     testAPI();
     } else if (response.status === 'not_authorized') {
     // The person is logged into Facebook, but not your app.
     document.getElementById('status').innerHTML = 'Please log ' +
     'into this app.';
     } else {
     // The person is not logged into Facebook, so we're not sure if
     // they are logged into this app or not.
     document.getElementById('status').innerHTML = 'Please log ' +
     'into Facebook.';
     }
     }
     */
    function fb_login(){
        FB.login(function(response) {

            if (response.authResponse) {
                console.log('Welcome!  Fetching your information.... ');
                //console.log(response); // dump complete info
                access_token = response.authResponse.accessToken; //get access token
                user_id = response.authResponse.userID; //get FB UID

                requetMyFacebookInfo(access_token);
                testAPI();
            } else {
                //user hit cancel button
                requestLogout();
                console.log('User cancelled login or did not fully authorize.');

            }
        }, {
            scope: 'publish_stream,email,public_profile,user_friends'
        });
    }

    function checkLoginState() {
        FB.getLoginStatus(function (response) {
            fb_login(response);
        });
    }


    window.fbAsyncInit = function () {
        FB.init({
            appId: '347355892131088',
            cookie: true,  // enable cookies to allow the server to access
                           // the session
            xfbml: true,  // parse social plugins on this page
            version: 'v2.1' // use version 2.1
        });
        FB.Event.subscribe('auth.logout', function (response) {
            document.location.reload();
        });

        FB.getLoginStatus(function (response) {
            fb_login(response);
        });
    };
    function requestLogout(){
        FB.api('/me', function (response) {
            console.log('logoutTest');
            var outdata='';
            if (response) {
                console.log(response);

                outdata.account_id = response.id;

                //$('.account_id').text(data.facebookId);

                var userInfo = new DefaultUserinfo();
                userInfo.setUserName(data.username);

                var outnc = new TjNetworkConnector();

                console.log('start');
                console.log(outdata);

                outnc.logoutFunc(outdata, function (result) {
                    var data = result.data;
                    console.log('recv');
                    console.log(data);

                });
            }
        });
    }
    function requetMyFacebookInfo(accessToken) {
        //서버로 전송할 데이터
        // 내이름
        // acesstoken
        // facebookid

        FB.api('/me', function (response) {
            console.log('facebook api');
            var data = {};
            if (response) {
                console.log(response);

                data.facebookId = response.id;

                $('.account_id').text(data.facebookId);

                data.username = response.last_name + response.first_name;
                data.accessToken = accessToken;

                var userInfo = new DefaultUserinfo();
                userInfo.setUserName(data.username);

                var nc = new TjNetworkConnector();

                console.log('start');
                console.log(data);

                nc.loginAndJoin(data, function (result) {
                    var data = result.data;
                    console.log('recv');
                    console.log(data);
//                  //아이디
                    userInfo.setUserId(data._id);
//                    localStorage.setItem("spUserId" , data._id);

                });
            }
        });
    }

    // Load the SDK asynchronously
    (function (d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s);
        js.id = id;
        js.src = "//connect.facebook.net/en_US/sdk.js";
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));

    function testAPI() {
        console.log('Welcome!  Fetching your information.... ');
        FB.api('/me?', function (response) {

        });
        $('#flgBnt').removeAttr("disabled");
    }

</script>

<div id="status">
</div>
<textarea class="account_id" style="display:none;"></textarea>
<!-- Carousel
================================================== -->

<a id="menuToggle" class="logout_test" href="#" onclick="FB.logout();">Logout</a>
<!-- ********** SLIDES ********** -->
<section id="home" name="home"></section>
<section id="slides">
    <ul class="slides-container">
        <li>
            <img src="images/bg005.jpg" alt="">
        </li>
        <li>
            <img src="images/bg006.jpg" alt="">
        </li>
    </ul>
    <div id="bannertext">
        <h1>Shared Preference</h1>
        <hr class="aligncenter">
        <h3><bold>Web Conference System</bold><br>Based on WebRTC</h3>
        <p><a href="#intro" onclick="checkLoginState();" class="btn btn-lg btn-clear btn-design smoothScroll">Facebook Login</a>
            <button id="flgBnt" disabled="disabled" data-toggle="modal" data-target="#myModal" class="btn btn-lg btn-y btn-design smoothScroll">Start SharedPreference</button>

        </p>
    </div>
    <!-- end:Banner text -->
    <nav class="slides-navigation"> </nav>
</section>

<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title">SharedPreference</h4>
            </div>
            <div class="modal-body">
                <p style="text-align:center">회의 Room을 생성합니다.</p>
                <button type="button" class="btn btn-success btn pull-right" onclick="createConference()">Create
                    Room
                </button>
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<!-- Marketing messaging and featurettes
================================================== -->
<!-- Wrap the rest of the page in another container to center all the content. -->

<!-- /.container -->
<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->

<script src="http://code.jquery.com/jquery-latest.min.js"></script>

<script src="/javascripts/bootstrap.min.js"></script>
<script src="/javascripts/classie.js"></script>
<script src="/javascripts/smoothscroll.js"></script>
<script src="/javascripts/mainLogin.js"></script>
<script src="/javascripts/retina-1.1.js"></script>
<script src="/javascripts/jquery (1).js"></script>
<script src="/javascripts/jquery.hammer.js"></script>
<script src="/javascripts/tjNetworkConnector.js"></script>
<script src="/javascripts/defaultUserinfo.js"></script>
<!--
<script>
    $(document).ready(function(){
        $('.logout_test').click(function(){
            var val=$('.account_id').val();
            console.log("1");
            console.log(val);
            $.ajax({
                url:'http://210.118.64.172:8000/account/leave',
                dataType:'json',
                data:val,
                type:'POST',
                success:function(result){
                    console.log("success");
                    console.log(result);
                }
            }).fail(function(){
                console.log("fail");
            });
        });
    });
</script>
-->
<script>
    $('#myModal').modal(options);
    $('#myModal').modal({
        keyboard: false
    });
    $('#myModal').modal('toggle');
    $('#myModal').modal('show');
    $('#myModal').modal('hide');


    //$('#boolControl').prop('disabled',true);
    //$('#boolControl').attr("disabled","disabled");
    function createConference() {
        var userinfo = new DefaultUserinfo();

        var username = userinfo.getUserName();
        if (username !== null) {
//            location.replace('http://210.118.64.172:8100' + username);
            location.href = 'http://210.118.64.172:8000';
        }
    }
</script>
<script>
    //Superslides
    $('#slides').superslides({
        slide_easing: 'easeInOutCubic',
        slide_speed: 800,
        pagination: true,
        hashchange: false,
        scrollable: true,
        animation: 'fade'
    });

    $('#slides').hammer().on('swipeleft', function () {
        $(this).superslides('animate', 'next');
    });

    $('#slides').hammer().on('swiperight', function () {
        $(this).superslides('animate', 'prev');
    });
</script>

<script>
    // Banner text add parallax efect and fade
    function EasyPeasyParallax() {
        scrollPos = $(this).scrollTop();
        $('#slider').css({
            'background-position': '50% ' + (-scrollPos / 4) + "px"
        });
        $('#bannertext').css({
            'margin-top': (scrollPos / 4) + "px",
            'opacity': 1 - (scrollPos / 250)
        });
    }
    $(document).ready(function () {
        $(window).scroll(function () {
            EasyPeasyParallax();
        });
    });
</script>

</body>
</html>